# ==========================================
# üß™ API Testing Examples - Social Chat
# ==========================================
# Tool: REST Client Extension (VS Code)
# ho·∫∑c d√πng Postman/Insomnia
# ==========================================

@baseUrl = http://localhost:8000/api
@token = YOUR_JWT_TOKEN_HERE

### ==========================
### 1Ô∏è‚É£ CONNECTION APIs
### ==========================

### 1.1. Send Connection Request
POST {{baseUrl}}/connections/send
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "recipientId": "USER_B_ID_HERE"
}

### 1.2. Get Pending Requests (Received)
GET {{baseUrl}}/connections/pending
Authorization: Bearer {{token}}

### 1.3. Accept Connection Request
PUT {{baseUrl}}/connections/CONNECTION_ID_HERE/accept
Authorization: Bearer {{token}}

### 1.4. Decline Connection Request
PUT {{baseUrl}}/connections/CONNECTION_ID_HERE/decline
Authorization: Bearer {{token}}

### 1.5. Get Friends List
GET {{baseUrl}}/connections/friends
Authorization: Bearer {{token}}

### 1.6. Get Sent Requests
GET {{baseUrl}}/connections/sent
Authorization: Bearer {{token}}

### 1.7. Remove Connection (Unfriend)
DELETE {{baseUrl}}/connections/CONNECTION_ID_HERE
Authorization: Bearer {{token}}

### 1.8. Block User
POST {{baseUrl}}/connections/block
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "userId": "USER_ID_TO_BLOCK"
}

### 1.9. Get Connection Status with Specific User
GET {{baseUrl}}/connections/status/USER_ID_HERE
Authorization: Bearer {{token}}

### ==========================
### 2Ô∏è‚É£ CHAT WITH PRINTER APIs
### ==========================

### 2.1. Create or Get Conversation with Printer
POST {{baseUrl}}/chat/conversations/printer/PRINTER_ID_HERE
Authorization: Bearer {{token}}

### ==========================
### 3Ô∏è‚É£ P2P CHAT APIs
### ==========================

### 3.1. Create or Get P2P Conversation (Must be friends first!)
POST {{baseUrl}}/chat/conversations/peer/USER_ID_HERE
Authorization: Bearer {{token}}

### ==========================
### 4Ô∏è‚É£ CHAT MESSAGE APIs
### ==========================

### 4.1. Get All Conversations (including bot, printer, peer)
GET {{baseUrl}}/chat/conversations
Authorization: Bearer {{token}}

### 4.2. Get Messages for Specific Conversation (Paginated)
GET {{baseUrl}}/chat/history/CONVERSATION_ID_HERE?page=1&limit=30
Authorization: Bearer {{token}}

### 4.3. Send Message
POST {{baseUrl}}/chat/message
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "message": "Xin ch√†o! üëã",
  "conversationId": "CONVERSATION_ID_HERE",
  "type": "text"
}

### 4.4. Send Rich Message (Product)
POST {{baseUrl}}/chat/message
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "message": "Check out this product!",
  "conversationId": "CONVERSATION_ID_HERE",
  "type": "product",
  "metadata": {
    "productId": "PRODUCT_ID_HERE",
    "productName": "Custom T-Shirt",
    "price": 150000,
    "image": "https://example.com/image.jpg"
  }
}

### 4.5. Upload File to Chat
POST {{baseUrl}}/chat/upload
Authorization: Bearer {{token}}
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="image.jpg"
Content-Type: image/jpeg

< ./path/to/image.jpg
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="conversationId"

CONVERSATION_ID_HERE
------WebKitFormBoundary7MA4YWxkTrZu0gW--

### 4.6. Rename Conversation
PATCH {{baseUrl}}/chat/conversations/CONVERSATION_ID_HERE
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "title": "Chat v·ªõi Shop In ƒê·∫πp"
}

### 4.7. Delete Conversation (Soft Delete)
DELETE {{baseUrl}}/chat/conversations/CONVERSATION_ID_HERE
Authorization: Bearer {{token}}

### ==========================
### 5Ô∏è‚É£ TEST SCENARIOS
### ==========================

### SCENARIO 1: Complete Friend Request Flow
# Step 1: User A sends request to User B
POST {{baseUrl}}/connections/send
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "recipientId": "USER_B_ID"
}

# Step 2: User B gets pending requests (switch token to User B)
GET {{baseUrl}}/connections/pending
Authorization: Bearer USER_B_TOKEN

# Step 3: User B accepts request
PUT {{baseUrl}}/connections/CONNECTION_ID/accept
Authorization: Bearer USER_B_TOKEN

# Step 4: Verify both are friends
GET {{baseUrl}}/connections/friends
Authorization: Bearer {{token}}

### SCENARIO 2: Chat with Printer
# Step 1: Create conversation
POST {{baseUrl}}/chat/conversations/printer/PRINTER_ID
Authorization: Bearer {{token}}

# Step 2: Send message
POST {{baseUrl}}/chat/message
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "message": "Shop in √°o ƒë∆∞·ª£c kh√¥ng ·∫°?",
  "conversationId": "CONVERSATION_ID_FROM_STEP_1"
}

### SCENARIO 3: P2P Chat (Must be friends first!)
# Step 1: Verify friendship
GET {{baseUrl}}/connections/friends
Authorization: Bearer {{token}}

# Step 2: Create P2P conversation
POST {{baseUrl}}/chat/conversations/peer/FRIEND_USER_ID
Authorization: Bearer {{token}}

# Step 3: Send message
POST {{baseUrl}}/chat/message
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "message": "Ch√†o b·∫°n! B·∫°n kh·ªèe kh√¥ng?",
  "conversationId": "CONVERSATION_ID_FROM_STEP_2"
}

### ==========================
### 6Ô∏è‚É£ ERROR TESTING
### ==========================

### Test: Send duplicate connection request (should fail)
POST {{baseUrl}}/connections/send
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "recipientId": "ALREADY_REQUESTED_USER_ID"
}

### Test: P2P chat with non-friend (should fail)
POST {{baseUrl}}/chat/conversations/peer/NON_FRIEND_USER_ID
Authorization: Bearer {{token}}

### Test: Accept connection by non-recipient (should fail)
PUT {{baseUrl}}/connections/CONNECTION_ID/accept
Authorization: Bearer WRONG_USER_TOKEN

