// apps/customer-backend/src/modules/chat/services/browser.service.js
// âœ… PATCH: Disable preInitialize() method

// TÃ¬m hÃ m preInitialize() (khoáº£ng dÃ²ng 110-135):

// âŒ CODE CÅ¨ (GÃ¢y crash):
/*
  async preInitialize() {
    if (puppeteerModule) {
      Logger.info('[BrowserService] Already pre-initialized');
      return;
    }

    Logger.info('[BrowserService] ğŸš€ Pre-initializing Puppeteer at server startup...');
    
    try {
      // âœ… Import Puppeteer TRÆ¯á»šC KHI cÃ³ báº¥t ká»³ job nÃ o
      await this._getPuppeteer();
      
      // âœ… Pre-launch browser Ä‘á»ƒ sáºµn sÃ ng ngay
      Logger.info('[BrowserService] ğŸš€ Pre-launching browser...');
      await this.getBrowser();
      
      Logger.info('[BrowserService] âœ… Pre-initialization completed successfully');
    } catch (error) {
      Logger.error('[BrowserService] âŒ Pre-initialization failed:', {
        message: error?.message || 'Unknown',
        name: error?.name || 'Error',
        code: error?.code || 'NO_CODE',
      });
      // âœ… KhÃ´ng throw Ä‘á»ƒ server váº«n cÃ³ thá»ƒ start
      Logger.warn('[BrowserService] âš ï¸ Browser will be initialized on first use');
    }
  }
*/

// âœ… CODE Má»šI (KhÃ´ng lÃ m gÃ¬ cáº£):

  /**
   * @deprecated KhÃ´ng dÃ¹ng ná»¯a - gÃ¢y crash server khi import Puppeteer
   * Browser sáº½ Ä‘Æ°á»£c khá»Ÿi táº¡o lazy khi cáº§n thiáº¿t (khi cÃ³ job Ä‘áº§u tiÃªn)
   */
  async preInitialize() {
    Logger.warn('[BrowserService] âš ï¸ preInitialize() is deprecated and does nothing');
    Logger.info('[BrowserService] ğŸŒ Browser will be initialized on first use (lazy load)');
    
    // âœ… KhÃ´ng import Puppeteer á»Ÿ Ä‘Ã¢y ná»¯a
    // âœ… Puppeteer sáº½ Ä‘Æ°á»£c import láº§n Ä‘áº§u trong _getPuppeteer() khi getBrowser() Ä‘Æ°á»£c gá»i
    // âœ… Äiá»u nÃ y trÃ¡nh crash server khi start
    
    return Promise.resolve();
  }

// âœ… Káº¾T QUáº¢:
// - Server start thÃ nh cÃ´ng khÃ´ng bá»‹ treo
// - Puppeteer Ä‘Æ°á»£c import láº§n Ä‘áº§u khi user gá»­i URL
// - Láº§n gá»­i URL Ä‘áº§u tiÃªn sáº½ cháº­m hÆ¡n (15-20s) do pháº£i import Puppeteer
// - CÃ¡c láº§n sau nhanh hÆ¡n vÃ¬ Ä‘Ã£ cÃ³ browser instance
