// apps/customer-backend/src/server.ts
// âœ… PATCH: Comment out pre-initialization Ä‘á»ƒ trÃ¡nh crash

// TÃ¬m Ä‘oáº¡n code nÃ y (khoáº£ng dÃ²ng 44-62):

/*
    // âœ… CRITICAL: Pre-initialize BrowserService NGAY SAU KHI Káº¾T Ná»I DB
    // Äiá»u nÃ y sáº½ load Puppeteer TRÆ¯C khi báº¥t ká»³ job nÃ o cháº¡y
    // GiÃºp trÃ¡nh crash khi import Puppeteer trong worker
    Logger.info('[Server] ğŸŒ Pre-initializing browser service...');
    try {
      const { getBrowserService } = await import('./modules/chat/services/browser.service.js');
      const browserService = getBrowserService();
      await browserService.preInitialize();
      Logger.success('[Server] âœ… Browser service ready');
    } catch (browserError) {
      Logger.error('[Server] âš ï¸ Browser pre-init failed, will retry on first use:', browserError);
      // KhÃ´ng throw error Ä‘á»ƒ server váº«n cháº¡y Ä‘Æ°á»£c
    }
*/

// âœ… THAY Báº°NG:

    // âŒ Bá» PRE-INIT: Puppeteer quÃ¡ náº·ng, sáº½ Ä‘Æ°á»£c load lazy khi cáº§n
    Logger.info('[Server] ğŸŒ Browser service will be initialized on first use (lazy load)');

// âœ… Káº¾T QUáº¢:
// - Server start nhanh hÆ¡n (3-5s thay vÃ¬ treo)
// - Puppeteer chá»‰ load khi user gá»­i URL láº§n Ä‘áº§u (lazy load)
// - KhÃ´ng cÃ²n crash!
