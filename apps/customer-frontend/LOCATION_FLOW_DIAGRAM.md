# ðŸ“ Location Autofill - Flow Diagram

## ðŸ”„ Complete Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER ACTION                              â”‚
â”‚                  Click "ðŸ“ Äá»‹nh vá»‹ hiá»‡n táº¡i"                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BROWSER GEOLOCATION API                       â”‚
â”‚              navigator.geolocation.getCurrentPosition()          â”‚
â”‚                                                                  â”‚
â”‚  Options:                                                        â”‚
â”‚  - enableHighAccuracy: true                                      â”‚
â”‚  - timeout: 10000ms                                              â”‚
â”‚  - maximumAge: 0                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                         â”‚
                â–¼                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   SUCCESS         â”‚     â”‚   ERROR           â”‚
    â”‚   Get Coords      â”‚     â”‚   Permission      â”‚
    â”‚   lat: 10.7769    â”‚     â”‚   Denied/Timeout  â”‚
    â”‚   lng: 106.7009   â”‚     â”‚   Unavailable     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                         â”‚
              â”‚                         â–¼
              â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚              â”‚  Show Error Toast â”‚
              â”‚              â”‚  with Instructionsâ”‚
              â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   REVERSE GEOCODING API                          â”‚
â”‚         reverseGeocode(lat, lng) â†’ Nominatim API                â”‚
â”‚                                                                  â”‚
â”‚  Request:                                                        â”‚
â”‚  GET https://nominatim.openstreetmap.org/reverse                â”‚
â”‚      ?format=json                                                â”‚
â”‚      &lat=10.7769                                                â”‚
â”‚      &lon=106.7009                                               â”‚
â”‚      &addressdetails=1                                           â”‚
â”‚      &accept-language=vi                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                         â”‚
                â–¼                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   SUCCESS         â”‚     â”‚   ERROR           â”‚
    â”‚   Get Address     â”‚     â”‚   API Failed      â”‚
    â”‚   {               â”‚     â”‚   Network Error   â”‚
    â”‚     city: "HCM"   â”‚     â”‚   Invalid Coords  â”‚
    â”‚     district: "Q1"â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚     ward: "P1"    â”‚               â”‚
    â”‚     street: "..."  â”‚               â–¼
    â”‚   }               â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  Show Error Toast â”‚
              â”‚                â”‚  Suggest Manual   â”‚
              â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ADDRESS NORMALIZATION                         â”‚
â”‚                                                                  â”‚
â”‚  normalizeCity("Há»“ ChÃ­ Minh")                                   â”‚
â”‚    â†’ "ThÃ nh phá»‘ Há»“ ChÃ­ Minh"                                    â”‚
â”‚                                                                  â”‚
â”‚  normalizeDistrict("1")                                          â”‚
â”‚    â†’ "Quáº­n 1"                                                    â”‚
â”‚                                                                  â”‚
â”‚  normalizeWard("1")                                              â”‚
â”‚    â†’ "PhÆ°á»ng 1"                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FORM AUTO-FILL                              â”‚
â”‚                                                                  â”‚
â”‚  form.setValue("shippingAddress.city", "ThÃ nh phá»‘ HCM")        â”‚
â”‚  form.setValue("shippingAddress.district", "Quáº­n 1")           â”‚
â”‚  form.setValue("shippingAddress.ward", "PhÆ°á»ng 1")             â”‚
â”‚  form.setValue("shippingAddress.street", "Nguyá»…n Huá»‡")         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CASCADING DROPDOWN UPDATE                      â”‚
â”‚                                                                  â”‚
â”‚  1. Find cityCode from VIETNAM_LOCATIONS                        â”‚
â”‚  2. Load districts for selected city                            â”‚
â”‚  3. Find districtCode                                            â”‚
â”‚  4. Load wards for selected district                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DISPLAY MAP                                 â”‚
â”‚                                                                  â”‚
â”‚  setDetectedLocation({ lat, lng, fullAddress })                 â”‚
â”‚  setShowMap(true)                                                â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  ðŸ—ºï¸ Leaflet Map                                   â”‚         â”‚
â”‚  â”‚  - Center: [lat, lng]                             â”‚         â”‚
â”‚  â”‚  - Zoom: 15                                        â”‚         â”‚
â”‚  â”‚  - Marker: ðŸ“ at user location                    â”‚         â”‚
â”‚  â”‚  - Popup: Full address                            â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SUCCESS FEEDBACK                              â”‚
â”‚                                                                  â”‚
â”‚  toast.success("âœ… ÄÃ£ xÃ¡c Ä‘á»‹nh vá»‹ trÃ­ cá»§a báº¡n!")                â”‚
â”‚  description: "PhÆ°á»ng 1, Quáº­n 1, ThÃ nh phá»‘ Há»“ ChÃ­ Minh"        â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ âœ… Vá»‹ trÃ­ Ä‘Ã£ Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh                        â”‚         â”‚
â”‚  â”‚ 123 Nguyá»…n Huá»‡, PhÆ°á»ng Báº¿n NghÃ©,                 â”‚         â”‚
â”‚  â”‚ Quáº­n 1, ThÃ nh phá»‘ Há»“ ChÃ­ Minh                    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AUTO-FOCUS                                  â”‚
â”‚                                                                  â”‚
â”‚  If street not detected:                                         â”‚
â”‚    â†’ Focus on "Äá»‹a chá»‰ cá»¥ thá»ƒ" input field                      â”‚
â”‚                                                                  â”‚
â”‚  User can now:                                                   â”‚
â”‚    - Review auto-filled data                                     â”‚
â”‚    - Edit any field if needed                                    â”‚
â”‚    - Continue to payment                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸŽ¯ State Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      COMPONENT STATE                             â”‚
â”‚                                                                  â”‚
â”‚  const [isDetecting, setIsDetecting] = useState(false)          â”‚
â”‚  const [detectedLocation, setDetectedLocation] = useState(null) â”‚
â”‚  const [showMap, setShowMap] = useState(false)                  â”‚
â”‚                                                                  â”‚
â”‚  const [selectedCityCode, setSelectedCityCode] = useState("")   â”‚
â”‚  const [selectedDistrictCode, setSelectedDistrictCode] = ...    â”‚
â”‚  const [availableDistricts, setAvailableDistricts] = ...        â”‚
â”‚  const [availableWards, setAvailableWards] = ...                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”„ State Transitions

```
Initial State:
  isDetecting: false
  detectedLocation: null
  showMap: false

User clicks button:
  isDetecting: true âœ…
  detectedLocation: null
  showMap: false

GPS success:
  isDetecting: true
  detectedLocation: null
  showMap: false

Geocoding success:
  isDetecting: false âœ…
  detectedLocation: { lat, lng, city, ... } âœ…
  showMap: true âœ…

Error occurred:
  isDetecting: false âœ…
  detectedLocation: null
  showMap: false
```

---

## ðŸŽ¨ UI Components Hierarchy

```
AddressForm
â”œâ”€â”€ Card
â”‚   â”œâ”€â”€ CardHeader
â”‚   â”‚   â”œâ”€â”€ CardTitle: "Äá»‹a chá»‰ giao hÃ ng"
â”‚   â”‚   â””â”€â”€ Button: "ðŸ“ Äá»‹nh vá»‹ hiá»‡n táº¡i"
â”‚   â”‚       â”œâ”€â”€ onClick: handleLocateMe()
â”‚   â”‚       â”œâ”€â”€ disabled: isDetecting
â”‚   â”‚       â””â”€â”€ Icon: MapPin | Loader2
â”‚   â”‚
â”‚   â””â”€â”€ CardContent
â”‚       â”œâ”€â”€ LocationMap (conditional: showMap && detectedLocation)
â”‚       â”‚   â”œâ”€â”€ Leaflet Map
â”‚       â”‚   â”œâ”€â”€ Marker at [lat, lng]
â”‚       â”‚   â””â”€â”€ Popup with address
â”‚       â”‚
â”‚       â”œâ”€â”€ Success Message (conditional: showMap)
â”‚       â”‚   â”œâ”€â”€ CheckCircle2 icon
â”‚       â”‚   â””â”€â”€ Full address text
â”‚       â”‚
â”‚       â”œâ”€â”€ FormField: fullName
â”‚       â”œâ”€â”€ FormField: phone
â”‚       â”œâ”€â”€ FormField: city (Select)
â”‚       â”œâ”€â”€ FormField: district (Select)
â”‚       â”œâ”€â”€ FormField: ward (Select)
â”‚       â””â”€â”€ FormField: street
```

---

## ðŸ”Œ API Integration

### Frontend â†’ Nominatim (Direct)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         HTTPS          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚   Nominatim API  â”‚
â”‚  (Frontend)  â”‚                         â”‚  (OpenStreetMap) â”‚
â”‚              â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      JSON Response      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Frontend â†’ Backend â†’ Nominatim (Fallback)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    POST /api/location   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚   Backend    â”‚
â”‚  (Frontend)  â”‚                         â”‚   (Node.js)  â”‚
â”‚              â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      JSON Response      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                 â”‚
                                                 â”‚ HTTPS
                                                 â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚   Nominatim API  â”‚
                                        â”‚  (OpenStreetMap) â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“Š Data Flow

```
GPS Coordinates
    â†“
{ lat: 10.7769, lng: 106.7009 }
    â†“
Nominatim API
    â†“
{
  display_name: "123 Nguyá»…n Huá»‡, PhÆ°á»ng Báº¿n NghÃ©, Quáº­n 1, TP HCM",
  address: {
    road: "Nguyá»…n Huá»‡",
    neighbourhood: "PhÆ°á»ng Báº¿n NghÃ©",
    suburb: "Quáº­n 1",
    city: "ThÃ nh phá»‘ Há»“ ChÃ­ Minh"
  }
}
    â†“
Normalization
    â†“
{
  city: "ThÃ nh phá»‘ Há»“ ChÃ­ Minh",
  district: "Quáº­n 1",
  ward: "PhÆ°á»ng Báº¿n NghÃ©",
  street: "Nguyá»…n Huá»‡",
  fullAddress: "123 Nguyá»…n Huá»‡, PhÆ°á»ng Báº¿n NghÃ©, Quáº­n 1, TP HCM",
  lat: 10.7769,
  lng: 106.7009
}
    â†“
Form Auto-fill
    â†“
React Hook Form
    â†“
User Review & Submit
```

---

## â±ï¸ Timeline

```
0ms     User clicks button
        â””â”€> setIsDetecting(true)

100ms   Browser shows permission dialog
        â””â”€> User clicks "Allow"

1000ms  GPS acquires location
        â””â”€> { lat: 10.7769, lng: 106.7009 }

1500ms  Call Nominatim API
        â””â”€> Waiting for response...

3000ms  Receive address data
        â””â”€> Parse and normalize

3100ms  Auto-fill form
        â””â”€> form.setValue(...)

3200ms  Update cascading dropdowns
        â””â”€> Load districts & wards

3300ms  Show map
        â””â”€> setShowMap(true)
        â””â”€> Initialize Leaflet

4000ms  Map fully loaded
        â””â”€> Show marker & popup

4100ms  Show success toast
        â””â”€> setIsDetecting(false)
        â””â”€> âœ… Complete!
```

---

## ðŸŽ¯ Key Takeaways

1. **User Experience**: 2-5 seconds from click to complete
2. **Error Handling**: Graceful fallback to manual input
3. **Performance**: Optimized with proper timeouts
4. **Privacy**: No tracking, open-source APIs
5. **Mobile-Friendly**: Works on all modern browsers

---

**Last Updated**: 2025-11-29
